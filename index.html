<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>尚品汇</title>
		<link rel="stylesheet" href="css/reset.css">
		<link rel="stylesheet" href="css/index.css">
	</head>
	<body>
		<!-- 外部容器 -->
		<div class="wrap">
			<!-- 头部容器 -->
			<header class="header">
				<!-- 头部导航 -->
				<div class="top">
					<!-- 头部导航栏左侧登录 -->
					<div class="left">
						<h>尚品汇欢迎您！</h>
						<span>请&nbsp;</span>
						<a href="#" class="info">登录</a>&nbsp;
						<a href="#">免费注册</a>
					</div>
					<!-- 头部导航右侧栏 -->
					<div class="right">
						<a href="#">我的订单</a>
						<a href="#">我的购物车</a>
						<a href="#">我的尚品汇</a>
						<a href="#">尚品汇会员</a>
						<a href="#">企业采购</a>
						<a href="#">关注尚品汇</a>
						<a href="#">合作招商</a>
						<a href="#">商家后台</a>
					</div>
				</div>
			</header>
				<!-- 搜索导航 -->
			<div class="search">
				<div class="bottom">
					<!-- 左侧logo -->
					<div class="logo">
						<h1>
							<img src="img/Logo.png" alt="">
						</h1>
					</div>
					<!-- 右侧搜索框 -->
					<div class="searchArea">
						<input type="text">
						<button>搜索</button>
					</div>
				</div>
			</div>
			<!-- 商品分类导航 -->
			<div class="nav">
				<div class="alls">
					<h3>全部商品分类</h3>
					<div class="goods">
						<a href="#">服装城</a>
						<a href="#">美妆馆</a>
						<a href="#">尚品汇超市</a>
						<a href="#">全球购</a>
						<a href="#">闪购</a>
						<a href="#">团购</a>
						<a href="#">有趣</a>
						<a href="#">秒杀</a>
					</div>
				</div>
			</div>
			<!-- 首屏主要内容区 -->
			<div class="main">
				<!-- 首屏内容区头部 -->
				<div class="main-top">
					<a href="#">手机、数码、通讯</a>
					<span>/</span>
					<a href="#">手机</a>
					<span>/</span>
					<a href="#">Apple 苹果</a>
					<span>/</span>
					<a href="#">iPhone 6s系列</a>
				</div>
				<!-- 首屏内容主体区域 -->
				<div class="main-content">
					<!-- 左侧放大镜区域 -->
					<div class="large">
						<!-- 左侧头部图片区域 -->
						<div class="large-top">
							<img src="img/s1.png" alt="">
						</div>
						<!-- 大图容器 -->
						<!-- 左侧底部图片区域 -->
						<div class="large-bottom">
							<a href="##" class="prev"><</a>
							<!--小图容器  -->
							<div class="picture">
								<ul class="list">
									<li><img src="img/b1.png" alt=""></li>
									<li><img src="img/b2.png" alt=""></li>
									<li><img src="img/b3.png" alt=""></li>
									<li><img src="img/b1.png" alt=""></li>
									<li><img src="img/b2.png" alt=""></li>
									<li><img src="img/b3.png" alt=""></li>
									<li><img src="img/b1.png" alt=""></li>
									<li><img src="img/b2.png" alt=""></li>
									<li><img src="img/b3.png" alt=""></li>
								</ul>	
							</div>
							<a href="##" class="next">></a>
						</div>
					</div>
					<!-- 右侧商品信息 -->
					<div class="main-info">
						<!-- 右侧商品信息上半部分 -->
						<div class="main-info-top">
							<h3>Apple iPhone 6s（A1700）64G玫瑰金色 移动通信电信4G手机</h3>
							<p>推荐选择下方[移动优惠购],手机套餐齐搞定,不用换号,每月还有花费返</p>
							<div class="price">
								<div class="price1">
									<div class="title">价&nbsp;&nbsp;&nbsp;格</div>
									<div class="price1-top">
										<em>￥</em>
										<span>5299</span>
										<i>降价通知</i>
									</div>
									<div class="remark">
										<i>累计评价</i>
										<span>10000</span>
									</div>
								</div>
								<div class="price2">
									<div class="title">促&nbsp;&nbsp;&nbsp;销</div>
									<div class="shopping">
										<span>加价购</span>
										<i>满999.00另加20.00元，或满1999.00另加30.00元，或满2999.00另加40.00元，即可在购物车换购热销商品</i>
									</div>
								</div>
							</div>
						</div>
						<!-- 右侧商品信息下半部分 -->
						<div class="main-info-bottom">
							
						</div>
					</div>
				</div>
			</div>
		</div>
		<script>
			window.addEventListener('DOMContentLoaded',function(){
				// 定义放大镜图片id
				var magnifierImgId = 0;
				//1.放大镜功能
				magnifying ();
				function magnifying(){
					var imgSrc = [
						{ b: "img/b1.png", s: "img/s1.png" },
						{ b: "img/b2.png", s: "img/s2.png" },
						{ b: "img/b3.png", s: "img/s3.png" },
						{ b: "img/b1.png", s: "img/s1.png" },
						{ b: "img/b2.png", s: "img/s2.png" },
						{ b: "img/b3.png", s: "img/s3.png" },
						{ b: "img/b1.png", s: "img/s1.png" },
						{ b: "img/b2.png", s: "img/s2.png" },
						{ b: "img/b3.png", s: "img/s3.png" }
					];
					// 修改放大镜的小图src为动态的数据
					var smallImg = document.querySelector('.wrap .main .main-content .large .large-top > img ');
					smallImg.src = imgSrc[magnifierImgId].s;
					//获取放大镜外层容器
					var wrap = document.querySelector('.wrap .main .main-content .large');
					//获取小图容器
					var smallBox = document.querySelector('.wrap .main .main-content .large .large-top');
					//初始化蒙版
					var mask = null;
					//初始化大图容器
					var bigBox = null;
					//初始化大图
					var bigImg = null;
					//绑定鼠标移入移出事件
					smallBox.onmouseenter = function(){
						// 当鼠标移入元素时  创建蒙版(大图容器 大图)   没有蒙版的时候 才会创建 如果存在则不创建
						if(!mask){
							// 创建蒙版
							mask = document.createElement('div');
							mask.className = 'mask';
							smallBox.appendChild(mask);
							// 创建大图和大图容器
							bigBox = document.createElement('div');
							bigBox.className = 'bigBox';
							wrap.appendChild(bigBox);
							bigImg = new Image();
							bigImg.src = imgSrc[magnifierImgId].b;
							bigBox.appendChild(bigImg);
						}
						// 绑定鼠标移动事件
						smallBox.onmousemove = function(event){
							// 当鼠标移动的时候  蒙版的位置是  鼠标的坐标 - 蒙版的一半 - 父级距离屏幕边缘的位置
							var maskPosition = {
								left:event.clientX - mask.offsetWidth/2 - smallBox.getBoundingClientRect().left,
								top:event.clientY - mask.offsetHeight/2 - smallBox.getBoundingClientRect().top
							};
							// 边界值判定
							if(maskPosition.left < 0){
								maskPosition.left = 0;
							}else if(maskPosition.left > smallBox.clientWidth - mask.offsetWidth){
								maskPosition.left = smallBox.clientWidth - mask.offsetWidth;
							}
							if(maskPosition.top < 0){
								maskPosition.top = 0;
							}else if(maskPosition.top > smallBox.clientHeight - mask.offsetHeight){
								maskPosition.top = smallBox.clientHeight - mask.offsetHeight;
							}
							// 对蒙版位置进行操作
							mask.style.left = maskPosition.left + 'px';
							mask.style.top = maskPosition.top + 'px';
							// 计算比例： （蒙版总共可以移动的距离 / 大图能够移动的距离
							var scale = (smallBox.clientWidth - mask.offsetWidth) / (bigImg.offsetWidth - bigBox.clientWidth);
							// 计算大图位置
							var bigPosition = {
								left:maskPosition.left / scale,
								top:maskPosition.top / scale
							}
							// 给大图修正位置
							bigImg.style.marginLeft = -bigPosition.left + 'px';
							bigImg.style.marginTop = -bigPosition.top + 'px';
						};
						// 鼠标移出事件 放大镜效果结束  清除蒙版
						smallBox.onmouseleave = function(){
							// 移除节点
							smallBox.removeChild(mask);
							wrap.removeChild(bigBox);
							// 初始化蒙版 大图和大图容器
							mask = null;
							bigBox = null;
							bigImg = null;
							// 解绑事件
							smallBox.onmousemove = null;
							smallBox.onmouseleave = null;
						}
					}
				}
				//获取元素非行间样式 第一个参数值是要读取的元素  第二个元素是要读取的样式名称
				function getStyle(obj,attr){
					if(obj.currentStyle){
						return obj.currentStyle[attr];
					}else{
						return document.defaultView.getComputedStyle(obj,null)[attr];
					}
				}
				
				//2.缩略图
				thumbnail();
				function thumbnail(){
					// 获取图片移动的容器
					var list = document.querySelector('.wrap .main .main-content .large .large-bottom .picture .list');
					//获取图片的集合
					var items = document.querySelectorAll('.wrap .main .main-content .large .large-bottom .picture .list > li');
					//获取左右俩个按钮
					var prev = document.querySelector('.wrap .main .main-content .large .large-bottom .prev');
					var next = document.querySelector('.wrap .main .main-content .large .large-bottom .next');
					//定义图片显示张数
					var showImg = 5;
					//定义初始化已经走过的距离
					var tempLeft = 0;
					//获取li的marginRight
					var itemRight = parseInt(getStyle(items[0],'marginRight'));
					// 计算一共可以移动的距离   (总张数 - 显示张数) * (图片的宽 + marginRight)
					var countLeft = (items.length - showImg) * (items[0].offsetWidth + itemRight);
					//每次移动的图片数量
					var moveNum = 2;
					//计算每次移动的长度  (一个元素的宽度 + marginRight)* 每次移动的图片数量
					var moveLeft = (items[0].offsetWidth + itemRight) * moveNum;
					// 添加过渡
					list.style.transition = '0.4s linear';
					//给俩个按钮绑定单击事件
					next.onclick = function(){
						// console.log('451');
						// 如果已经走过的距离 小于 总共可以走的距离 才能移动
						if(tempLeft < countLeft){
							// 如果剩余的距离大于每次可以移动的距离  则走该移动的距离(moveLeft)
							if(countLeft - tempLeft > moveLeft){
								tempLeft += moveLeft;
							}else{
								tempLeft += (countLeft - tempLeft);
							}
							list.style.left = -tempLeft + 'px';
						}
					};
					prev.onclick = function(){
						// console.log('854');
						// 如果可移动距离还大于0  说明可以向左移动
						if(tempLeft > 0){
							// 如果可以走的距离 大于每次移动的距离  则走该走的长度 否则直接为0
							if(tempLeft > moveLeft){
								tempLeft -= moveLeft;
							}else{
								tempLeft = 0;
							}
							list.style.left = -tempLeft + 'px';
						}
					};	
				}
				//3.缩略图点击
				thumbnailClick();
				function thumbnailClick(){
					//获取所有图片
					var itemImgs = document.querySelectorAll('.wrap .main .main-content .large .large-bottom .picture .list > li > img');
					//获取小图
					var smallImg = document.querySelector('.wrap .main .main-content .large .large-top > img');
					for(var i = 0; i < itemImgs.length; i++){
						itemImgs[i].onclick = function(){
							console.log('451');
							for(var i = 0;i < itemImgs.length; i++){
								if(itemImgs[i] == this){
									magnifierImgId = i;
									//修改小图路径
									smallImg.src = this.src;
								}
							}
						}
					}
				}
			})
		</script>
	</body>
</html>
